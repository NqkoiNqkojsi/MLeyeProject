<!DOCTYPE html>
    
<head>
        <title>Index</title>
        <meta charset="utf-8">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <style>
            .container {
                margin: 30px;
            }
            .containerContent {
                display: block;
                width: 600px;
                margin: auto;
            }
            .containerLiveFeed {
                width: 500px;
                height: 375px;
                border: 10px #333 solid;
            }
            #videoElement {
                width: 500px;
                height: 375px;
                background-color: #666;
            }
            .button {
                background-color: #4CAF50; /* Green */
                border: none;
                color: white;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin-bottom: 8%;
                margin-left: 17%;
                width: 60%;
            }
            .button:hover {background-color: #3e8e41}

            .button:active {
            background-color: #3e8e41;
            box-shadow: 0 5px #666;
            transform: translateY(4px);
            }
            .button2 {
                background-color: #c06457; /* Green */
                border: none;
                color: white;
                padding: 15px 32px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin-bottom: 8%;
                margin-left: 17%;
                width: 60%;
            }
            .button2:hover {background-color: #8d4e46}

            .button2:active {
            background-color: #8d4e46;
            box-shadow: 0 5px rgb(73, 73, 73);
            transform: translateY(4px);
            }
        </style>
    </head>
    
    <body>
        <div class="containerContent">
            <div class="container containerHeader">
                <h1>Hustle Watch<span>&#8482;</span> User Interface</h1>
            </div>
            
            <div class="container containerLiveFeed">
                <img id="VideoElement" src="../test_img/empty.jpg" width="100%">
            </div>
            <h2 id="Msg"></h2>
            <div class="container containerSettings">
                <form action="/index" method="post">
                    <button type="button" onclick="ButtonPress()" class="button" id="Video">Start</button>
                    <div>
                        <label for="user_IP">Enter your IP:</label>
                        <input type="text" id="user_IP" name="user_IP" required>
                    </div>
                    <div>
                        <input type="radio" id="taze" name="settings" value="taze" checked="checked">
                        <label for="taze">Taze</label>
                        <input type="radio" id="vibrate" name="settings" value="vibrate">
                        <label for="vibrate">Vibrate</label>
                    </div>
                </form>
            </div>

            <script>
                var video = document.querySelector("#videoElement");

                if (navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: true })
                    .then(function (stream) {
                    video.srcObject = stream;
                    })
                    .catch(function (err0r) {
                    console.log("Something went wrong!");
                    });
                }
                function sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                }

                obj={"state":[1,1,1,1,1,1,1,1], "isAsleep":false, "ip":"192.168.1.10:5000", "mode":1, "img":""};

                function ButtonPress() {
                    button=document.getElementById("Video");
                    if(button.innerHTML=="Start"){
                        button.classList.remove('button');
                        button.classList.add('button2');
                        button.innerHTML="Stop";
                        GenerateImg();
                    }else{
                        button.classList.remove('button2');
                        button.classList.add('button');
                        button.innerHTML="Start";
                        $("#VideoElement").attr("src", "../test_img/empty.jpg")
                    }
                }

                async function GenImage() {
                    button=document.getElementById("Video")
                    while(button.innerHTML=="Stop"){
                        button=document.getElementById("Video")
                        $.post("http://127.0.0.1:5000/start_feed", obj,
                        function(data, status){
                            obj=JSON.parse(data);
                            //$("#VideoElement").attr("src", "data:image/png;base64,"+obj["img"]);
                        });
                        await sleep(10*1000)
                    }
                }

                async function GenerateImg(){
                    button=document.getElementById("Video")
                    while(button.innerHTML=="Stop"){
                        button=document.getElementById("Video")
                        $.ajax({
                            type: "POST",
                            url: "http://127.0.0.1:5000/start_feed",
                            // The key needs to match your method's input parameter (case-sensitive).
                            data: JSON.stringify(obj),
                            contentType: "application/json; charset=utf-8",
                            dataType: "json",
                            success: function(data){
                                console.log(data);
                                obj=data;
                                $("#VideoElement").attr("src", "data:image/png;base64,"+obj["img"]);
                            },
                            error: function(errMsg) {
                                alert(errMsg);
                            }
                        });
                        await sleep(2*1000)
                    }
                }   
            </script>
        </div>
    </body>
</html>
